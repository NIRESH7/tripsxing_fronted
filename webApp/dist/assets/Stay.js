import{G as be,a as je,b as fe,c as Se,d as we,u as Ce,j as t,F,r as w,D as Fe,q as N}from"./index.js";import{r as y,x as o,y as G,S as I,M as C,T as L,B as g,d as Ie,z as ke,f as q,F as Ve,c as r,E as ve,o as V,U as Me,G as Ee,s as p}from"./antd.js";import{S as D,D as P}from"./MutationHooks.js";import{R as $e}from"./UploadOutlined.js";import"./reactRouterDom.js";import"./zustand.js";const Ue=()=>{const[k,j]=y.useState({isCreateVisible:!1,isEditVisible:!1,isViewVisible:!1,isFilterVisible:!1,editingRecord:{}}),[v,B]=y.useState(""),[f]=o.useForm(),[u]=o.useForm(),{data:M,isLoading:R}=be(),{data:h}=je(),{data:x}=fe(),{data:b}=Se(),{data:S}=we(),[W,Q]=y.useState(10),[H,J]=y.useState(new Map),[_,X]=y.useState(new Map),[Y,Z]=y.useState(new Map),[ee,T]=y.useState([]),[te,se]=y.useState([]),U=Ce(e=>e.CurrentUserData.id);y.useEffect(()=>{if(h){const e=new Map(h.map(s=>[s.name,s.id]));J(e)}},[h]),y.useEffect(()=>{if(x){const e=new Map(x.map(s=>[s.name,s.id]));X(e)}},[x]),y.useEffect(()=>{if(b){const e=new Map(b.map(s=>[s.name,s.id]));Z(e)}},[b]);const ae=[{title:"SI.no",dataIndex:"siNo",key:"siNo"},{title:"Stay Name",dataIndex:"name",key:"name",sorter:(e,s)=>e.name.localeCompare(s.name),sortDirections:["descend","ascend"],filterDropdown:e=>t.jsx(F,{...e,placeholder:"Search Stay Name"}),onFilter:(e,s)=>s.name.toLowerCase().includes(e.toLowerCase())},{title:"Contact",dataIndex:"contact",key:"contact"},{title:"Price",dataIndex:"price",key:"price"},{title:"City",dataIndex:"city",key:"city",filterDropdown:e=>t.jsx(F,{...e,placeholder:"Search City"}),onFilter:(e,s)=>s.city.toLowerCase().includes(e.toLowerCase())},{title:"State",dataIndex:"state",key:"state",filterDropdown:e=>t.jsx(F,{...e,placeholder:"Search State"}),onFilter:(e,s)=>s.state.toLowerCase().includes(e.toLowerCase())},{title:"Country",dataIndex:"country",key:"country",filterDropdown:e=>t.jsx(F,{...e,placeholder:"Search Country"}),onFilter:(e,s)=>s.country.toLowerCase().includes(e.toLowerCase())},{title:"Address",dataIndex:"address",key:"address",filterDropdown:e=>t.jsx(F,{...e,placeholder:"Search Address"}),onFilter:(e,s)=>s.address.toLowerCase().includes(e.toLowerCase()),render:e=>t.jsx(G,{title:e,children:t.jsx("span",{className:"text-center",children:`${e.slice(0,50)}...`})}),width:"20%"},{title:"Images",dataIndex:"images",key:"images",render:e=>t.jsx(I,{size:"middle",className:"cursor-pointer",children:e.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("img",{src:e[0],alt:"stay",style:{width:100,height:50,objectFit:"cover"},onClick:()=>{C.info({title:"All Images",content:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:e.map((s,a)=>t.jsx("img",{src:s,alt:`stay-${a}`,style:{width:"200px",height:"200px",objectFit:"cover"}},a))}),width:800})}}),e.length>1&&t.jsxs(L,{color:"blue",className:"cursor-pointer",onClick:()=>{C.info({title:"All Images",content:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:e.map((s,a)=>t.jsx("img",{src:s,alt:`stay-${a}`,style:{width:"200px",height:"200px",objectFit:"cover"}},a))}),width:800})},children:["+",e.length-1," more"]})]})})},{title:"Videos",dataIndex:"videos",key:"videos",render:e=>t.jsx(I,{size:"middle",className:"cursor-pointer",children:e.length>0&&t.jsx("span",{onClick:()=>{C.info({title:`Videos (${e.length})`,content:t.jsx(I,{size:"middle",children:e.map((s,a)=>t.jsx("div",{style:{display:"inline-block",margin:5},children:t.jsx("iframe",{width:"250",height:"200",src:`https://www.youtube.com/embed/${s.split("/")[s.split("/").length-1].split("?")[0]}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})},a))}),width:800})},children:t.jsxs(G,{title:"Click to view videos",children:[e.length," videos"]})})})},{title:"Special Facilities",dataIndex:"specialFacilities",key:"specialFacilities",render:e=>t.jsx(t.Fragment,{children:e&&e.length>0?e==null?void 0:e.map((s,a)=>t.jsx(L,{color:"blue",children:s.name},a)):"No special facilities"}),filters:S==null?void 0:S.map(e=>({text:e.name,value:e.id})),onFilter:(e,s)=>s.specialFacilities.map(a=>a.id).includes(e)},{title:"Action",key:"action",render:e=>t.jsxs(I,{size:"middle",children:[t.jsx(g,{icon:t.jsx(Ie,{}),onClick:()=>{ce(e)}}),t.jsx(g,{icon:t.jsx(ke,{}),onClick:()=>oe(e)})]})}],{mutate:ie}=D({mutationKey:["CreateStay"],queryKeyToInvalidate:["Stays"],getSuccessMessage:e=>`Stay ${e.id?"updated":"created"} successfully`,getErrorMessage:e=>`Failed to ${e.id?"update":"create"} stay: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,s,a,l)=>console.log("onSettledCallback",e,s,a,l),routes:w.backend.createStay}),{mutate:K}=D({mutationKey:["uploadFileCountry"],queryKeyToInvalidate:["GetCountry"],getSuccessMessage:()=>"File uploaded successfully",getErrorMessage:e=>`Failed to Upload file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,s,a,l)=>console.log("onSettledCallback",e,s,a,l),routes:w.backend.uploadfile}),le=async()=>{f.validateFields().then(e=>{console.log("Create:",e);const s={name:e.stayName,address:e.address,description:e.description,contact:e.contact,price:e.price,countryId:e.country,stateId:e.state,cityId:e.city,email:e.email,specialFacilities:e.specialFacilities,videos:e.videos,rating:1};ie(s,{onSuccess:async a=>{console.log("Stay created:",a);const l=new FormData;e.images.fileList.forEach(n=>{l.append("files",n.originFileObj)}),l.append("stayId",a.data.id),K(l,{onSuccess:async()=>{f.resetFields(),await N.invalidateQueries({queryKey:["Stays"]})},onError:n=>{console.error("Image upload failed:",n),p.error("Image upload failed")}}),p.success("Stay created successfuly")},onError:a=>{console.error("Failed to save country data:",a),p.error(`Failed to save country data ${a}`)}}),j(a=>({...a,isCreateVisible:!1})),f.resetFields()}).catch(e=>{console.log("Validate Failed:",e)})},oe=e=>{j(s=>({...s,isEditVisible:!0,editingRecord:e})),console.log("Edit:",e),B(e.id?e.id.toString():""),u.setFieldsValue({stayName:e.name,address:e.address,email:e.email,description:e.description,contact:e.contact,price:e.price,country:e.country,state:e.state,city:e.city,specialFacilities:e.specialFacilities.map(s=>s.id),images:e.images.map((s,a)=>({uid:a,name:s,status:"done",url:s})),videos:e.videos})},{mutate:ne}=D({mutationKey:["updateStay"],queryKeyToInvalidate:["Stays"],getSuccessMessage:e=>`Stay ${e.id?"updated":"created"} successfully`,getErrorMessage:e=>`Failed to ${e.id?"update":"create"} stay: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,s,a,l)=>console.log("onSettledCallback",e,s,a,l),routes:w.backend.updateStay,isUpdate:!0}),de=()=>{u.validateFields().then(e=>{console.log("Edit:",e);const s=H.get(e.country),a=_.get(e.state);let l;typeof e.city=="string"?l=Y.get(e.city):l=e.city,console.log("Country ID:",s,"State ID:",a,"City ID:",l);const n={id:v,name:e.stayName,address:e.address,description:e.description,contact:e.contact,price:e.price,email:e.email,countryId:s,stateId:a,cityId:l,adminId:U,rating:1,videos:e.videos,specialFacilities:e.specialFacilities,userId:localStorage.getItem("TripxingUserData")?JSON.parse(localStorage.getItem("TripxingUserData")).id:void 0};ne(n,{onSuccess:d=>{if(console.log("Stay created:",d),e.images.fileList||e.videos.fileList){const m=new FormData;e.images.fileList.forEach(i=>{m.append("files",i.originFileObj)}),m.append("stayId",d.data.id),K(m,{onSuccess:()=>{u.resetFields()},onError:i=>{console.error("Image upload failed:",i),p.error("Image upload failed")}})}p.success("Saved successfully")},onError:d=>{console.error("Failed to stay data:",d),p.error(`Failed to stay data ${d}`)}}),j(d=>({...d,isEditVisible:!1,editingRecord:null})),u.resetFields()}).catch(e=>{console.log("Validate Failed:",e),p.error("Failed to save stay")})},ce=e=>{j(s=>({...s,isViewVisible:!0,editingRecord:e}))},{mutate:re}=P({mutationKey:["deleteFile"],queryKeyToInvalidate:["Stays"],getSuccessMessage:()=>"File deleted successfully",getErrorMessage:e=>`Failed to delete file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,s,a,l)=>console.log("onSettledCallback",e,s,a,l),routes:w.backend.deleteFile}),{mutate:ue}=P({mutationKey:["deleteVideos"],queryKeyToInvalidate:["Stays"],getSuccessMessage:()=>"File deleted successfully",getErrorMessage:e=>`Failed to delete file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,s,a,l)=>console.log("onSettledCallback",e,s,a,l),routes:w.backend.deleteVideos}),z=e=>{const s=e.split("/");return s[s.length-1]},pe=e=>{const s=z(e),a={key:s,stayId:v,url:e};console.log("data",a),re(a,{onSuccess:()=>{const l=(u.getFieldValue("images")||[]).filter(n=>z(n.url)!==s);u.setFieldsValue({images:l}),p.success("File deleted successfully")},onError:l=>{p.error(`Failed to delete file: ${l}`)}})},O=e=>{console.log("url",e);const s={stayId:v,url:e};console.log("data",s),ue(s,{onSuccess:()=>{const a=(u.getFieldValue("videos")||[]).filter(l=>l!==e);u.setFieldsValue({videos:a}),p.success("File deleted successfully")},onError:a=>{p.error(`Failed to delete file: ${a}`)}})},me=e=>{const s=b==null?void 0:b.find(a=>a.id===e);if(s){const a=x==null?void 0:x.find(l=>l.id===s.stateId);if(a){const l=h==null?void 0:h.find(n=>n.id===a.countryId);f.setFieldsValue({state:a.id,country:l==null?void 0:l.id})}}},A=(e,s,a,l,n)=>{var d,m;return t.jsx(C,{title:t.jsx("span",{children:e}),open:s,onCancel:a,footer:[t.jsx(g,{onClick:a,children:"Close"},"back"),t.jsx(g,{type:"primary",onClick:l,children:"Save"},"submit")],width:800,children:t.jsxs(o,{form:n,layout:"horizontal",name:"basic",initialValues:{remember:!0},colon:!1,labelCol:{span:4},wrapperCol:{span:24},children:[t.jsx(o.Item,{name:"stayName",label:"Stay Name",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(o.Item,{name:"description",label:"Description",rules:[{required:!1}],children:t.jsx(r.TextArea,{})}),t.jsx(o.Item,{name:"email",label:"Email",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(o.Item,{name:"contact",label:"Contact Number",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(o.Item,{name:"price",label:"Price",rules:[{required:!0}],children:t.jsx(ve,{defaultValue:0})}),t.jsx(o.Item,{name:"address",label:"Address",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(o.Item,{name:"city",label:"City",rules:[{required:!0}],children:t.jsx(V,{showSearch:!0,allowClear:!0,options:b==null?void 0:b.map(i=>({value:i.id,label:i.name})),onChange:i=>me(i),filterOption:(i,c)=>((c==null?void 0:c.label)??"").toLowerCase().includes(i.toLowerCase())})}),t.jsx(o.Item,{name:"state",label:"State",rules:[{required:!0}],children:t.jsx(V,{showSearch:!0,allowClear:!0,disabled:!0,options:x==null?void 0:x.map(i=>({value:i.id,label:i.name})),filterOption:(i,c)=>((c==null?void 0:c.label)??"").toLowerCase().includes(i.toLowerCase())})}),t.jsx(o.Item,{name:"country",label:"Country",rules:[{required:!0}],children:t.jsx(V,{showSearch:!0,allowClear:!0,disabled:!0,options:h==null?void 0:h.map(i=>({value:i.id,label:i.name})),filterOption:(i,c)=>((c==null?void 0:c.label)??"").toLowerCase().includes(i.toLowerCase())})}),t.jsx(o.Item,{name:"specialFacilities",label:"Special Facilities",rules:[{required:!1}],children:t.jsx(V,{mode:"multiple",showSearch:!0,allowClear:!0,options:S==null?void 0:S.map(i=>({value:i.id,label:i.name})),defaultValue:n.getFieldValue("specialFacilities")||[]})}),t.jsx(o.Item,{name:"images",label:"Images",children:t.jsx(Me,{multiple:!0,listType:"picture",beforeUpload:()=>!1,children:t.jsx(g,{icon:t.jsx($e,{}),children:"Upload Images"})})}),e==="Edit Stay"&&u&&((d=u.getFieldValue("images"))==null?void 0:d.map(i=>(console.log("file",i),t.jsxs("div",{style:{position:"relative",display:"inline-block",margin:5},children:[t.jsx("img",{src:i.url,alt:i.name,style:{width:100,height:100,objectFit:"cover"}},i.uid),t.jsx(q,{style:{position:"absolute",top:0,right:0,color:"red",cursor:"pointer"},onClick:()=>{pe(i.url)}})]})))),t.jsx(o.Item,{label:"Videos",children:t.jsx(o.List,{name:"videos",children:(i,{add:c,remove:E})=>t.jsxs(t.Fragment,{children:[i.map(({key:he,name:$,...xe})=>(console.log("fields",i),t.jsxs(I,{style:{display:"flex",marginBottom:8},align:"baseline",children:[t.jsx(o.Item,{...xe,name:[$],rules:[{required:!0,message:"Missing benefit"}],children:t.jsx(r,{placeholder:"Videos"})}),t.jsx(g,{type:"link",onClick:()=>{E($),O(u.getFieldValue(["videos",$]))},children:"Remove"})]},he))),t.jsx(g,{type:"dashed",onClick:()=>c(),block:!0,icon:t.jsx(Ee,{}),children:"Add Videos"})]})})}),e==="Edit Stay"&&((m=u.getFieldValue("videos"))==null?void 0:m.map(i=>{console.log("url",i);const c=i.split("/")[i.split("/").length-1].split("?")[0];console.log("videoId",c);const E=`https://www.youtube.com/embed/${c}`;return console.log("url",i),t.jsxs("div",{style:{position:"relative",display:"inline-block",margin:5},children:[t.jsx("iframe",{width:"200",height:"150",src:E,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),t.jsx(q,{style:{position:"absolute",top:0,right:0,color:"red",cursor:"pointer"},onClick:()=>{O(i)}})]},i)}))]})})},ye=(e,s,a)=>{var l;return t.jsx(C,{title:t.jsx("span",{children:"View Stay"}),open:e,onCancel:s,footer:[t.jsx(g,{onClick:s,children:"Close"},"back")],width:800,children:t.jsxs(o,{layout:"horizontal",colon:!1,labelCol:{span:4},wrapperCol:{span:24},initialValues:a?{stayName:a.name,description:a.description,email:a.email,contact:a.contact,price:a.price,address:a.address,city:a.city,state:a.state,country:a.country,specialFacilities:a.specialFacilities,images:a.images,videos:a.videos}:{},children:[t.jsx(o.Item,{name:"stayName",label:"Stay Name",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"description",label:"Description",children:t.jsx(r.TextArea,{disabled:!0})}),t.jsx(o.Item,{name:"email",label:"Email",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"contact",label:"Contact Number",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"price",label:"Price",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"address",label:"Address",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"city",label:"City",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"state",label:"State",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"country",label:"Country",children:t.jsx(r,{disabled:!0})}),t.jsx(o.Item,{name:"specialFacilities",label:"Special Facilities",children:t.jsx("div",{style:{minHeight:"32px"},children:(l=a==null?void 0:a.specialFacilities)==null?void 0:l.map((n,d)=>t.jsx(L,{color:"blue",children:n.name},d))})}),(a==null?void 0:a.images)&&a.images.length>0&&t.jsx(o.Item,{label:"Images",children:t.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:a.images.map((n,d)=>t.jsx("div",{style:{position:"relative",display:"inline-block"},children:t.jsx("img",{src:n,alt:`stay-${d}`,style:{width:100,height:100,objectFit:"cover",cursor:"pointer"},onClick:()=>{C.info({title:n.split("/").pop(),content:t.jsx("img",{src:n,alt:"stay",style:{width:"100%",maxHeight:"80vh",objectFit:"contain"}}),width:800})}})},d))})}),(a==null?void 0:a.videos)&&a.videos.length>0&&t.jsx(o.Item,{label:"Videos",children:t.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:a.videos.map((n,d)=>{const m=n.split("/")[n.split("/").length-1].split("?")[0];return t.jsx("div",{style:{position:"relative",display:"inline-block"},children:t.jsx("iframe",{width:"200",height:"150",src:`https://www.youtube.com/embed/${m}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})},d)})})})]})})},ge=async()=>{if(ee.length===0)p.error("Please select a blog to delete");else if(confirm("Are you sure you want to delete this blog?")){const e=await Fe(w.backend.deleteStay,{userId:U,id:te.map(s=>s.id)});if(e.statusCode===200){p.success("Stay deleted successfully");const s=await N.invalidateQueries({queryKey:["Stays"]});console.log("data",N.getQueriesData({queryKey:["Stays"]})),console.log("data",s),T([])}else p.error({content:e.message,key:"updatable",duration:2})}};return t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx(g,{type:"primary",onClick:()=>j(e=>({...e,isCreateVisible:!0})),children:"Create Stay"}),t.jsx(g,{type:"text",className:"bg-red-500 text-white border-none rounded-md px-4 py-2 hover:bg-red-600",onClick:()=>ge(),icon:t.jsx(q,{}),children:"Delete Stay"})]})}),t.jsx(Ve,{columns:ae,dataSource:R?[]:M==null?void 0:M.map((e,s)=>{var a,l,n,d,m,i;return{key:s,id:e.id,siNo:s+1,name:e.name,email:((n=(l=(a=e.Users)==null?void 0:a[0])==null?void 0:l.user)==null?void 0:n.email)||"",contact:e.contact,price:e.price,country:(d=e.country)==null?void 0:d.name,state:(m=e.state)==null?void 0:m.name,city:(i=e.city)==null?void 0:i.name,address:e.address,description:e.description,images:e.images,videos:e.videos,specialFacilities:e.specialFacilities,User:e.Users}}),loading:R,scroll:{x:1300},size:"small",pagination:{pageSize:W,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,s)=>{Q(s),console.log("Page size changed to:",s)},showTotal:(e,s)=>`${s[0]}-${s[1]} of ${e} items`},rowSelection:{type:"checkbox",onChange:(e,s)=>{console.log("selectedRowKeys",e),T(e),se(s),console.log("selectedRows",s)}}}),A("Create Stay",k.isCreateVisible,()=>{j(e=>({...e,isCreateVisible:!1})),f.resetFields()},le,f),A("Edit Stay",k.isEditVisible,()=>{j(e=>({...e,isEditVisible:!1,editingRecord:null})),u.resetFields()},de,u),ye(k.isViewVisible,()=>{j(e=>({...e,isViewVisible:!1}))},k.editingRecord)]})};export{Ue as default};
