const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BlogComponent.js","assets/index.js","assets/antd.js","assets/reactRouterDom.js","assets/zustand.js","assets/index.css"])))=>i.map(i=>d[i]);
import{_ as ee,e as te,u as A,f as S,r as y,j as t,q as D,D as ae}from"./index.js";import{r as n,s as x,x as u,c as T,S as F,B as r,H as O,y as q,o as h,T as se,d as le,z as oe,G as ie,f as V,F as ne,D as re,M as L,U as de}from"./antd.js";import{R as ce}from"./UploadOutlined.js";import"./reactRouterDom.js";import"./zustand.js";const ue=n.lazy(()=>ee(()=>import("./BlogComponent.js"),__vite__mapDeps([0,1,2,3,4,5]))),ge={id:0,title:"",description:"",content:"",datePosted:"",category:"",status:"",views:0,authorId:0,deletedFlag:!1,Media:[],images:[],videos:[]},ye=()=>{const[b,_]=x.useMessage(),[U,f]=n.useState(!1),[g,N]=n.useState(!1),[d,K]=n.useState(!1),[o,w]=n.useState(null),[P,M]=n.useState([]),[c]=u.useForm(),[Q,G]=n.useState(10),{data:k,isLoading:H}=te(),{CurrentUserData:v}=A(),R=n.useRef(null),{RangePicker:z}=re,Y=A(e=>e.CurrentUserData.id),j=async e=>{try{b.loading({content:"Saving blog...",key:"updatable"});const a=await S({method:g?"put":"post",url:g?y.backend.updateBlog:y.backend.createBlog,data:e,headers:{Authorization:`Bearer ${localStorage.getItem("TripxingToken")}`}});a.status===200?(b.success({content:a.data.message,key:"updatable",duration:2}),await D.invalidateQueries({queryKey:["Blogs"]}),f(!1)):b.error({content:a.data.message,key:"updatable",duration:2})}catch{b.error({content:"Failed to save blog",key:"updatable",duration:2})}},p=n.useCallback((e,a,s)=>{N(a),K(s),w(e),c.setFieldsValue(e),f(!0)},[c]),J=n.useCallback(()=>p(ge,!1,!1),[p]),E=n.useCallback(e=>p(e,!0,!1),[p]),B=n.useCallback(e=>p(e,!1,!0),[p]),W=async()=>{if(P.length===0)x.error("Please select a blog to delete");else if(confirm("Are you sure you want to delete this blog?")){const e=await ae(y.backend.deleteBlog,{userId:Y,id:P});if(e.statusCode===200){x.success("Blog deleted successfully");const a=await D.invalidateQueries({queryKey:["Blogs"]});console.log("data",D.getQueriesData({queryKey:["Blogs"]})),console.log("data",a),M([])}else x.error({content:e.message,key:"updatable",duration:2})}},$=n.useCallback(()=>{c.validateFields().then(e=>{var a;if(g){const s={...e,id:o==null?void 0:o.id,userId:v.id,content:e.content,media:[]};if(typeof((a=e.Media)==null?void 0:a[0])!="object"){s.media=o==null?void 0:o.Media,console.log("variables",s),j(s);return}const l=new FormData;e.Media.forEach(i=>{l.append("files",i.originFileObj)}),l.append("type","blog"),S.post(y.backend.uploadfile,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("TripxingToken")}`}}).then(i=>{console.log("Image upload response:",i),c.resetFields(),f(!1),j({...s,media:o==null?void 0:o.Media.concat(i.data.data.map(m=>m.url))})}).catch(i=>{console.error("Image upload failed:",i),x.error("Image upload failed")})}else{const s={...e,content:e.content,userId:v.id,media:[]},l=new FormData;e.Media.forEach(i=>{l.append("files",i.originFileObj)}),l.append("type","blog"),console.log("formData",l),S.post(y.backend.uploadfile,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("TripxingToken")}`}}).then(i=>{console.log("Image upload response:",i),c.resetFields(),f(!1),j({...s,media:i.data.data.map(m=>m.url)})}).catch(i=>{console.error("Image upload failed:",i),x.error("Image upload failed")}),console.log("variables",s)}}).catch(console.error)},[c,g,o,v.id,j]),C=n.useCallback(()=>{f(!1),w(null)},[]),I=n.useCallback(e=>({filterDropdown:({setSelectedKeys:a,selectedKeys:s,confirm:l,clearFilters:i})=>t.jsxs("div",{style:{padding:8},children:[t.jsx(T,{placeholder:`Search ${e}`,value:s[0],onChange:m=>a(m.target.value?[m.target.value]:[]),onPressEnter:()=>l(),style:{width:188,marginBottom:8,display:"block"}}),t.jsxs(F,{children:[t.jsx(r,{type:"primary",onClick:()=>l(),icon:t.jsx(O,{}),size:"small",style:{width:90},children:"Search"}),t.jsx(r,{onClick:()=>i(),size:"small",style:{width:90},children:"Reset"})]})]}),filterIcon:a=>t.jsx(O,{style:{color:a?"#1890ff":void 0}}),onFilter:(a,s)=>{var l;return((l=s[e])==null?void 0:l.toString().toLowerCase().includes(a.toString().toLowerCase()))||!1},onFilterDropdownOpenChange(a){a&&setTimeout(()=>{var s;return(s=R.current)==null?void 0:s.focus()},100)},render:a=>a}),[R]),X=n.useMemo(()=>[{title:"SI.No",dataIndex:"sno",key:"sno",width:"5%"},{title:"Title",dataIndex:"title",key:"title",width:"20%",render:e=>e.trim().length>50?t.jsx(q,{title:e,children:e.slice(0,50)+"..."}):e,sorter:(e,a)=>e.title.localeCompare(a.title),filterSearch:!0,...I("title")},{title:"Description",dataIndex:"description",key:"description",width:"40%",render:e=>e.trim().length>90?t.jsx(q,{title:e,children:e.slice(0,90)+"..."}):e},{title:"Date Posted",dataIndex:"datePosted",key:"datePosted",render:e=>new Date(e).toDateString(),width:"10%",sorter:(e,a)=>new Date(e.datePosted).getTime()-new Date(a.datePosted).getTime(),filterDropdown:({setSelectedKeys:e,confirm:a,clearFilters:s})=>t.jsxs("div",{className:`
                    flex
                    justify-between
                    items-center
                    space-x-2
                    w-full
                    p-2
                    bg-white
                    border
                    border-gray-200
                    rounded-md
                    shadow-md
                    `,children:[t.jsx(z,{renderExtraFooter:()=>"",onChange:(l,i)=>{e(i)}}),t.jsxs(h,{className:"w-full",placeholder:"Select Date",onChange:l=>{e([l])},children:[t.jsx(h.Option,{value:"today",children:"Today"}),t.jsx(h.Option,{value:"yesterday",children:"Yesterday"}),t.jsx(h.Option,{value:"last7days",children:"Last 7 Days"}),t.jsx(h.Option,{value:"last30days",children:"Last 30 Days"})]}),t.jsx(r,{type:"primary",onClick:()=>{a()},children:"OK"}),t.jsx(r,{onClick:()=>s(),children:" Reset "})]})},{title:"Category",dataIndex:"category",key:"category",width:"10%",sorter:(e,a)=>e.category.localeCompare(a.category),filterSearch:!0,...I("category")},{title:"Status",dataIndex:"status",key:"status",width:"10%",filters:[{text:"Draft",value:"draft"},{text:"Published",value:"published"},{text:"Archived",value:"archived"}],render:e=>{let a="geekblue";return e==="published"?a="green":e==="archived"&&(a="volcano"),t.jsx(se,{color:a,children:e.toUpperCase()},e)},onFilter:(e,a)=>a.status===e},{title:"Views",dataIndex:"views",key:"views",width:"5%",sorter:(e,a)=>e.views-a.views},{title:"Action",key:"action",width:"10%",render:e=>t.jsxs(F,{size:"middle",children:[t.jsx(r,{icon:t.jsx(le,{}),onClick:()=>B(e)}),t.jsx(r,{icon:t.jsx(oe,{}),onClick:()=>{console.log("Edit",e),E(e)}})]})}],[I,z,B,E]),Z=()=>{var e;return t.jsx(L,{title:g?"Edit Blog":d?"View Blog":"Create Blog",open:U,onOk:d?C:$,onCancel:C,okText:g?"Save":d?"Close":"Create",cancelText:"Close",footer:d?t.jsx(r,{onClick:C,children:"Close"},"close"):t.jsxs(t.Fragment,{children:[t.jsx(r,{onClick:C,children:"Close"},"cancel"),t.jsx(r,{type:"primary",onClick:$,children:g?"Save":"Create"},"submit")]}),width:"80%",maskClosable:!1,keyboard:!1,children:t.jsxs(u,{form:c,layout:"vertical",children:[t.jsx(u.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please input the title!"}],children:t.jsx(T,{disabled:d})}),t.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please input the description!"}],children:t.jsx(T.TextArea,{disabled:d})}),t.jsx(u.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select the category!"}],children:t.jsx(h,{disabled:d,options:[{label:"Pilgrimage",value:"pilgrimage"},{label:"Tourist Spots",value:"touristSpots"},{label:"Travel",value:"travel"},{label:"Food",value:"food"},{label:"Lifestyle",value:"lifestyle"}]})}),t.jsx(u.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select the status!"}],children:t.jsx(h,{disabled:d,options:[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Archived",value:"archived"}]})}),t.jsx(u.Item,{name:"Media",label:"Media Files",rules:[{required:!0,message:"Please upload the media files!"}],children:t.jsx(de,{listType:"picture",beforeUpload:()=>!1,accept:"image/png, image/jpeg, image/jpg",onChange:a=>{console.log("info",a),c.setFieldsValue({Media:a.fileList})},children:t.jsx(r,{icon:t.jsx(ce,{}),children:"Upload Images"})})}),t.jsx(F,{size:"middle",className:`cursor-pointer
                        `,children:(e=o==null?void 0:o.Media)==null?void 0:e.map((a,s)=>t.jsxs("div",{children:[t.jsx(V,{className:"absolute  text-red-500",onClick:()=>{if(confirm("Are you sure you want to delete this image?")){const l=o==null?void 0:o.Media;l==null||l.splice(s,1),w({...o,Media:l})}}}),t.jsx("img",{src:a,alt:"stay",style:{width:100,height:100,objectFit:"cover"},onClick:()=>{L.info({title:`Image ${s+1}`,content:t.jsx("img",{src:a,alt:"stay",style:{width:"100%",height:"100%"}}),width:700})}},s)]}))}),t.jsx(u.Item,{name:"content",label:"Content",rules:[{required:!0,message:"Please input the content!"}],children:t.jsx(n.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:t.jsx(ue,{value:(o==null?void 0:o.content)||"",onChange:a=>c.setFieldsValue({content:a}),disabled:d})})})]})})};return t.jsxs("div",{style:{padding:"20px"},children:[_,t.jsxs("div",{className:`
                flex gap-4
            `,children:[t.jsx(r,{type:"primary",style:{marginBottom:"20px"},onClick:J,icon:t.jsx(ie,{}),children:"Create Blog"}),t.jsx(r,{type:"text",className:"bg-red-500 text-white border-none rounded-md px-4 py-2 hover:bg-red-600",onClick:()=>W(),icon:t.jsx(V,{}),children:"Delete Blog"})]}),t.jsx(ne,{columns:X,dataSource:k==null?void 0:k.map((e,a)=>({...e,sno:a+1})),rowKey:"id",loading:H,pagination:{pageSize:Q,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,a)=>{G(a),console.log("Page size changed to:",a)},showTotal:(e,a)=>`${a[0]}-${a[1]} of ${e} items`},size:"small",rowSelection:{type:"checkbox",onChange:(e,a)=>{console.log("selectedRowKeys",e),M(e),console.log("selectedRows",a)}}}),t.jsx(Z,{})]})};export{ye as default};
