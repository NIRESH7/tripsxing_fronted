import{i as J,u as z,r as u,j as t,q as x,D as W}from"./index.js";import{r as p,s as n,x as i,B as b,M as I,c as N,U as E,y as X,f as Y,J as Z}from"./antd.js";import{S as k,D as _}from"./MutationHooks.js";import{R as U}from"./UploadOutlined.js";import"./reactRouterDom.js";import"./zustand.js";const ie=()=>{const[$,f]=p.useState(!1),[j,F]=p.useState([]),[C,g]=p.useState(!1),[A,h]=p.useState(!1),[o,R]=p.useState(null),[d,K]=n.useMessage(),{data:y}=J(),[c]=i.useForm(),[m]=i.useForm(),S=()=>{f(!1),h(!1),R(null),g(!1),c.resetFields()},q=z(e=>e.CurrentUserData.id),D=e=>{console.log("info",e),e.fileList.length>0&&(console.log("info.fileList",e.fileList),g(!0),F(e.fileList))},M=()=>{g(!1),F([])},O=e=>{R(e),e.link&&g(!0),console.log("reel",e),c.setFieldsValue({...e,active:e.status==="active"}),h(!0)},{mutate:L}=k({mutationKey:["uploadReel"],queryKeyToInvalidate:["Reels"],getSuccessMessage:e=>`Reel ${e.id?"updated":"created"} successfully`,getErrorMessage:e=>`Failed to ${e.id?"update":"create"} stay: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,l,a,s)=>console.log("onSettledCallback",e,l,a,s),routes:u.backend.uploadReel}),{mutate:w}=k({mutationKey:["uploadFileReel"],queryKeyToInvalidate:["GetCountry"],getSuccessMessage:()=>"File uploaded successfully",getErrorMessage:e=>`Failed to Upload file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,l,a,s)=>console.log("onSettledCallback",e,l,a,s),routes:u.backend.uploadfile}),{mutate:T}=k({mutationKey:["updateStay"],queryKeyToInvalidate:["Reels"],getSuccessMessage:e=>`Stay ${e.id?"updated":"created"} successfully`,getErrorMessage:e=>`Failed to ${e.id?"update":"create"} stay: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,l,a,s)=>console.log("onSettledCallback",e,l,a,s),routes:u.backend.updateReel,isUpdate:!0}),{mutate:P}=_({mutationKey:["deleteFile"],queryKeyToInvalidate:["Stays"],getSuccessMessage:()=>"File deleted successfully",getErrorMessage:e=>`Failed to delete file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,l,a,s)=>console.log("onSettledCallback",e,l,a,s),routes:u.backend.deleteFile}),V=async()=>{try{const e=await m.validateFields();console.log("Create:",e);const l={description:e.description};d.open({content:"Creating reel...",key:"reel-creation",type:"loading",duration:0}),L(l,{onSuccess:async a=>{var r;console.log("Reel created:",a);const s=new FormData;(r=e.videos)!=null&&r.fileList&&e.videos.fileList.forEach(v=>{s.append("files",v.originFileObj)}),s.append("reelId",a.data.id),w(s,{onSuccess:async()=>{console.log("Files uploaded successfully"),m.resetFields(),await x.invalidateQueries({queryKey:["Reels"]}),d.success({content:"Reel created successfully!",key:"reel-creation"})},onError:v=>{console.error("File upload failed:",v),d.error({content:"File upload failed. Please try again.",key:"reel-creation"})}})},onError:a=>{console.error("Failed to save reel data:",a),d.error({content:`Failed to save reel data: ${a.message||a}`,key:"reel-creation"})}}),f(!1),m.resetFields()}catch(e){console.error("Validation Failed:",e),d.error({content:"Please fix the form errors before submitting.",key:"reel-creation"})}},Q=()=>{let e;c.validateFields().then(l=>{console.log("Create:",l),o&&(console.log("selectedReel",o),e={description:l.description,status:l.active?"active":"inactive",id:o.id}),T(e,{onSuccess:a=>{if(console.log("Reel created:",a),l.videos){const s=new FormData;l.videos.fileList.forEach(r=>{s.append("files",r.originFileObj)}),s.append("reelId",a.data.id),w(s,{onSuccess:()=>{c.resetFields()},onError:r=>{console.error("Image upload failed:",r),n.error("Image upload failed")}}),n.success("Reel added successfuly")}},onError:a=>{console.error("Failed to save reel data:",a),n.error(`Failed to save reel data ${a}`)}}),h(!1),c.resetFields()}).catch(l=>{console.log("Validate Failed:",l)})},B=e=>{const l=e.split("/");return l[l.length-1]},G=e=>{const a={key:B(o.link),reelId:e,url:o.link};console.log("data",a),P(a,{onSuccess:()=>{n.success("File deleted successfully")},onError:s=>{n.error(`Failed to delete file: ${s}`)}})},H=async e=>{if(confirm("Are you sure you want to delete this reel?")){const l=await W(u.backend.deleteReel,{userId:q,id:e});if(l.statusCode===200){n.success("Reel deleted successfully");const a=await x.invalidateQueries({queryKey:["Reels"]});console.log("data",x.getQueriesData({queryKey:["Reels"]})),console.log("data",a)}else n.error({content:l.message,key:"updatable",duration:2})}};return t.jsxs("div",{className:"min-h-screen bg-gray-100",children:[K,t.jsx("div",{className:"p-4 flex justify-between items-center",children:t.jsx(b,{type:"primary",onClick:()=>f(!0),children:"Add Reel"})}),t.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:y&&y.length>0?y.map(e=>t.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-white shadow hover:shadow-lg transition duration-300",children:[t.jsx("div",{className:"relative cursor-pointer",onClick:()=>O(e),children:t.jsx("div",{className:"w-full aspect-[4/5]",children:t.jsx("video",{src:e.link,controls:!0,className:"w-full h-full object-cover"})})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),H(e.id)},className:"absolute top-2 right-2 bg-white bg-opacity-80 p-2 rounded-full hover:bg-opacity-100 transition",children:t.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/1214/1214428.png",alt:"Delete",className:"w-4 h-4"})}),t.jsx("p",{className:"mt-2 text-xs text-gray-700 text-center p-2",children:e.description})]},e.id)):t.jsx("p",{className:"text-center text-gray-500",children:"No reels available"})}),t.jsx(I,{title:"Add Reel",open:$,onOk:V,onCancel:S,children:t.jsxs(i,{form:m,layout:"vertical",children:[t.jsx(i.Item,{name:"description",label:"Description",children:t.jsx(N.TextArea,{})}),t.jsx(i.Item,{name:"videos",label:"Upload Reel",children:t.jsx(E,{listType:"picture",beforeUpload:()=>!1,fileList:j,onChange:D,onRemove:M,children:t.jsx(b,{icon:t.jsx(U,{}),disabled:C,children:"Upload Reel"})})})]})}),t.jsx(I,{title:"Edit Reel",open:A,onOk:Q,onCancel:S,children:o&&t.jsxs(i,{form:c,layout:"vertical",initialValues:{description:o.description},children:[t.jsx(i.Item,{label:"Description",name:"description",rules:[{required:!0,message:"Please enter a description"}],children:t.jsx(N,{placeholder:"Enter reel description"})}),t.jsx(i.Item,{name:"videos",label:"Upload Reel",children:t.jsx(E,{listType:"picture",beforeUpload:()=>!1,fileList:j,onChange:D,onRemove:M,children:t.jsx(b,{icon:t.jsx(U,{}),disabled:C,children:"Upload Reel"})})}),t.jsx("div",{className:"relative w-1/2 mb-4",children:o.link&&t.jsxs("div",{id:"video",className:"relative",children:[t.jsx("video",{src:o.link,controls:!0,className:"w-full h-full object-cover rounded-lg"}),t.jsx(X,{title:"Delete Reel",children:t.jsx(Y,{className:"absolute top-2 right-2 text-red-500 text-xl cursor-pointer bg-white bg-opacity-70 p-1 rounded-full",onClick:()=>G(o.id)})})]})}),t.jsx(i.Item,{name:"active",label:"Active",valuePropName:"checked",children:t.jsx(Z,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})})]})};export{ie as default};
