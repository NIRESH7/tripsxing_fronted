import{d as V,u as L,r as y,q as g,j as a,F,D as O}from"./index.js";import{s as d,r as u,x as p,B as c,G as P,f as v,F as Q,M as _,c as A,U as B,S as D,h as G,d as H,z as J}from"./antd.js";import{S as M,D as W}from"./MutationHooks.js";import{R as X}from"./UploadOutlined.js";import"./reactRouterDom.js";import"./zustand.js";const oe=()=>{const{data:U}=V(),[f,K]=d.useMessage(),[s,C]=u.useState({visible:!1,mode:"create"}),[n,$]=u.useState({name:"",description:"",userId:"",ImageUrl:""}),[E,q]=u.useState(10),[k,S]=u.useState([]),[l]=p.useForm(),{CurrentUserData:h}=L(),j=(e,t)=>{C({visible:!0,mode:e}),t?($(t),l.setFieldsValue({...t,images:t.ImageUrl})):l.resetFields()},m=u.useCallback(()=>C({...s,visible:!1}),[s]),{mutate:x}=M({mutationKey:s.mode==="edit"?["Amenity",n==null?void 0:n.id]:["Amenities",n==null?void 0:n.id],queryKeyToInvalidate:["Amenity"],getSuccessMessage:()=>s.mode==="edit"?"Amenity updated successfully!":"Amenity saved successfully!",getErrorMessage:()=>"Failed to save Amenity",onMutateCallback:()=>f.loading({content:s.mode==="edit"?"Updating Amenity...":"Creating Amenity...",key:"updatable"}),onSettledCallback:e=>{e.statusCode===200?f.success({content:e.message,key:"updatable",duration:2}):f.error({content:e.message,key:"updatable",duration:2})},routes:s.mode==="edit"?`${y.backend.updateAmenity}/${n.id}`:y.backend.createAmenity,isUpdate:s.mode==="edit"}),{mutate:b}=M({mutationKey:["uploadFileCountry"],queryKeyToInvalidate:["Amenity"],getSuccessMessage:()=>"File uploaded successfully",getErrorMessage:e=>`Failed to Upload file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,t,i,o)=>console.log("onSettledCallback",e,t,i,o),routes:y.backend.uploadfile}),I=u.useCallback(()=>{l.validateFields().then(e=>{const t={...e,userId:h.id,status:e.status?"active":"inactive"};s.mode==="edit"?x({id:n.id,...t},{onSuccess:async i=>{console.log("Stay created:",i);const o=new FormData;e.images.fileList.forEach(r=>{o.append("files",r.originFileObj)}),o.append("aminitesId",i.data.id),b(o,{onSuccess:async()=>{l.resetFields(),await g.invalidateQueries({queryKey:["Amenity"]})},onError:r=>{console.error("Image upload failed:",r),d.error("Image upload failed")}}),d.success("Amenity created successfuly")}}):x(t,{onSuccess:async i=>{console.log("Stay created:",i);const o=new FormData;e.images.fileList.forEach(r=>{o.append("files",r.originFileObj)}),o.append("aminitesId",i.data.id),b(o,{onSuccess:async()=>{l.resetFields(),await g.invalidateQueries({queryKey:["Amenity"]})},onError:r=>{console.error("Image upload failed:",r),d.error("Image upload failed")}}),d.success("Amenity created successfuly")}}),m()}).catch(e=>console.log("Validation failed:",e))},[l,h.id,s.mode,m,x,n.id,b]),R=[{title:"SI.No",dataIndex:"id",key:"id",render:(e,t,i)=>i+1,sorter:(e,t)=>(e.id??0)-(t.id??0),sortDirections:["descend","ascend"]},{title:"Amenity Name",dataIndex:"name",key:"name",sorter:(e,t)=>e.name.localeCompare(t.name),sortDirections:["descend","ascend"],filterDropdown:e=>a.jsx(F,{...e,placeholder:"Search by Name"}),onFilter:(e,t)=>t.name.toLowerCase().includes(e.toLowerCase())},{title:"Description",dataIndex:"description",key:"description",sorter:(e,t)=>e.description.localeCompare(t.description),sortDirections:["descend","ascend"],filterDropdown:e=>a.jsx(F,{...e,placeholder:"Search by Description"}),onFilter:(e,t)=>t.description.toLowerCase().includes(e.toLowerCase())},{title:"Images",dataIndex:"imageUrl",key:"imageUrl",render:e=>(console.log("imagescadscascas",e),a.jsx(D,{size:"middle",className:"cursor-pointer",children:e&&e.length>0&&a.jsx(G,{src:e,alt:"amenity",style:{width:50,height:50,objectFit:"cover"},preview:{mask:a.jsx(H,{})}})}))},{title:"Action",key:"action",render:e=>a.jsx(D,{size:"middle",children:a.jsx(c,{icon:a.jsx(J,{}),onClick:()=>j("edit",e)})})}],{mutate:z}=W({mutationKey:["deleteFile"],queryKeyToInvalidate:["Amenity"],getSuccessMessage:()=>"File deleted successfully",getErrorMessage:e=>`Failed to delete file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,t,i,o)=>console.log("onSettledCallback",e,t,i,o),routes:y.backend.deleteFile}),w=e=>{const t=e.split("/");return t[t.length-1]},N=e=>{const t=w(e),i={key:t,aminitesId:n.id,url:e};console.log("data",i),z(i,{onSuccess:()=>{const o=(l.getFieldValue("images")||[]).filter(r=>w(r.url)!==t);console.log("updatedImages",o),l.setFieldsValue({images:o}),d.success("File deleted successfully")},onError:o=>{d.error(`Failed to delete file: ${o}`)}})};//! Amenitiy List Delete
const T=async()=>{if(k.length===0)d.error("Please select a amenity to delete");else if(confirm("Are you sure you want to delete this amenity?")){const e=await O(y.backend.deleteMultipleAmenities,{userId:h.id,amenityIds:k});if(e.statusCode===200){d.success("Amenity deleted successfully");const t=await g.invalidateQueries({queryKey:["Amenity"]});console.log("data",g.getQueriesData({queryKey:["Amenity"]})),console.log("data",t),S([])}else d.error({content:e.message,key:"updatable",duration:2})}};return a.jsxs("div",{style:{padding:"20px"},children:[K,a.jsxs("div",{className:`
                flex gap-4
            `,children:[a.jsx(c,{type:"primary",style:{marginBottom:"20px"},onClick:()=>j("create"),icon:a.jsx(P,{}),children:"Create Amenity"}),a.jsx(c,{type:"text",className:"bg-red-500 text-white border-none rounded-md px-4 py-2 hover:bg-red-600",onClick:()=>T(),icon:a.jsx(v,{}),children:"Delete Amenity"})]}),a.jsx(Q,{columns:R,dataSource:U,rowKey:"id",size:"small",pagination:{pageSize:E,onShowSizeChange:(e,t)=>{q(t),console.log("Page size changed to:",t)},showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},rowSelection:{type:"checkbox",onChange:(e,t)=>{console.log("selectedRowKeys",e),S(e),console.log("selectedRows",t)}}}),a.jsx(_,{title:s.mode==="edit"?"Edit Amenity":s.mode==="view"?"View Amenity":"Create Amenity",open:s.visible,onOk:s.mode==="view"?m:I,onCancel:m,okText:s.mode==="edit"?"Save":s.mode==="view"?"Close":"Create",footer:s.mode==="view"?[a.jsx(c,{onClick:m,children:"Close"},"close")]:[a.jsx(c,{onClick:m,children:"Close"},"cancel"),a.jsx(c,{type:"primary",onClick:I,children:s.mode==="edit"?"Save":"Create"},"submit")],children:a.jsxs(p,{form:l,layout:"vertical",children:[a.jsx(p.Item,{name:"name",label:"Amenity Name",rules:[{required:!0,message:"Please input the name!"}],children:a.jsx(A,{disabled:s.mode==="view"})}),a.jsx(p.Item,{name:"description",label:"Description",children:a.jsx(A.TextArea,{disabled:s.mode==="view"})}),(s.mode==="edit"||s.mode==="view")&&l.getFieldValue("imageUrl")&&a.jsx(p.Item,{label:"Current Image",children:a.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[a.jsx("img",{src:l.getFieldValue("imageUrl"),alt:"amenity",style:{width:100,height:100,objectFit:"cover"}}),s.mode==="edit"&&a.jsx(v,{style:{position:"absolute",top:0,right:0,color:"red",cursor:"pointer",backgroundColor:"white",padding:"4px",borderRadius:"50%"},onClick:()=>N(l.getFieldValue("imageUrl"))})]})}),s.mode!=="view"&&a.jsx(p.Item,{name:"images",label:"Images",children:a.jsx(B,{multiple:!0,listType:"picture",beforeUpload:()=>!1,children:a.jsx(c,{icon:a.jsx(X,{}),children:"Upload Images"})})})]})})]})};export{oe as default};
