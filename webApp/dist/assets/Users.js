import{h as $,u as K,r as x,j as t,F as g,D as q,q as f}from"./index.js";import{S as B}from"./MutationHooks.js";import{s as c,r as n,x as a,M as P,B as o,G as H,f as L,F as V,T as S,S as _,d as O,z as G,c as r,o as u}from"./antd.js";import"./reactRouterDom.js";import"./zustand.js";const Z=()=>{const{data:w,isLoading:C}=$(),[d,I]=c.useMessage(),[A,p]=n.useState(!1),[l,k]=n.useState("view"),[U,M]=n.useState(10),[i,h]=n.useState(null),[y,v]=n.useState([]),F=K(e=>e.CurrentUserData.id),[D]=a.useForm(),m=(e,s)=>{k(e),p(!0),s&&h(s)},j=()=>{p(!1),h(null)},{mutate:b}=B({mutationKey:l==="edit"?["User",i==null?void 0:i.id]:["Users",i==null?void 0:i.id],queryKeyToInvalidate:["Users"],getSuccessMessage:()=>l==="edit"?"User updated successfully!":"User saved successfully!",getErrorMessage:()=>"Failed to save User",onMutateCallback:()=>d.loading({content:l==="edit"?"Updating User...":"Creating User...",key:"updatable"}),onSettledCallback:e=>{e.statusCode===200?(d.success({content:e.message,key:"updatable",duration:2}),j()):d.error({content:e.message,key:"updatable",duration:2})},routes:l==="edit"?`${x.backend.updateUser}/${i==null?void 0:i.id}`:x.backend.createUser,isUpdate:l==="edit"}),z=(e,s)=>{D.validateFields().then(()=>{b({...e})}).catch(()=>{d.error({content:"Please fill in all required fields",key:"updatable",duration:2})})},N=async()=>{if(y.length===0)c.error("Please select a blog to delete");else if(confirm("Are you sure you want to delete this blog?")){const e=await q(x.backend.deleteUser,{userId:F,ids:y});if(e.statusCode===200){c.success("Blog deleted successfully");const s=await f.invalidateQueries({queryKey:["Blogs"]});console.log("data",f.getQueriesData({queryKey:["Blogs"]})),console.log("data",s),v([])}else c.error({content:e.message,key:"updatable",duration:2})}},R=()=>t.jsxs(a,{layout:"vertical",initialValues:i||{},onFinish:e=>{z(e)},children:[t.jsx(a.Item,{label:"Username",name:"userName",children:t.jsx(r,{})}),t.jsx(a.Item,{label:"Email",name:"email",children:t.jsx(r,{})}),t.jsx(a.Item,{label:"Role",name:"role",children:t.jsx(u,{options:[{label:"Super Admin",value:"superAdmin"},{label:"Hotel Admin",value:"hotelAdmin"},{label:"Customer",value:"customer"}]})}),t.jsx(a.Item,{label:"Password",name:"password",children:t.jsx(r.Password,{})}),t.jsx(a.Item,{label:"Status",name:"status",children:t.jsx(u,{options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]})}),l!=="view"&&t.jsx(a.Item,{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:t.jsx(o,{type:"primary",htmlType:"submit",children:"Save"})})]}),T=()=>t.jsxs(a,{layout:"vertical",initialValues:i||{},onFinish:e=>{b(e)},children:[t.jsx(a.Item,{label:"Username",name:"userName",children:t.jsx(r,{disabled:l==="view"})}),t.jsx(a.Item,{label:"Email",name:"email",children:t.jsx(r,{disabled:l==="view"})}),t.jsx(a.Item,{label:"Role",name:"role",children:t.jsx(u,{disabled:l==="view",options:[{label:"Super Admin",value:"superAdmin"},{label:"Hotel Admin",value:"hotelAdmin"},{label:"Customer",value:"customer"}]})}),t.jsx(a.Item,{label:"Status",name:"status",children:t.jsx(u,{disabled:l==="view",options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]})}),l==="edit"&&t.jsx(a.Item,{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:t.jsx(o,{type:"primary",htmlType:"submit",children:"Save"})})]});return t.jsxs("div",{children:[t.jsx(P,{title:l==="view"?"User Details":"Edit User",open:A,onCancel:j,footer:null,children:l==="create"?t.jsx(R,{}):t.jsx(T,{})}),t.jsxs("div",{style:{padding:"20px"},children:[I,t.jsxs("div",{className:`
                flex gap-4
            `,children:[t.jsx(o,{type:"primary",style:{marginBottom:"20px"},onClick:()=>m("create"),icon:t.jsx(H,{}),children:"Create User"}),t.jsx(o,{type:"text",className:"bg-red-500 text-white border-none rounded-md px-4 py-2 hover:bg-red-600",onClick:()=>N(),icon:t.jsx(L,{}),children:"Delete User"})]}),t.jsx(V,{columns:[{title:"S/N",dataIndex:"sno",key:"sno",render:(e,s,E)=>E+1},{title:"ID",dataIndex:"id",key:"id"},{title:"UserName",dataIndex:"userName",key:"userName",sorter:(e,s)=>e.userName.localeCompare(s.userName),sortDirections:["descend","ascend"],filterDropdown:e=>t.jsx(g,{...e,placeholder:"Search by Name"}),onFilter:(e,s)=>s.userName.toLowerCase().includes(e.toLowerCase())},{title:"Email",dataIndex:"email",key:"email",filterDropdown:e=>t.jsx(g,{...e,placeholder:"Search by Email"}),onFilter:(e,s)=>s.email.toLowerCase().includes(e.toLowerCase())},{title:"Role",dataIndex:"role",key:"role",render:e=>t.jsx(S,{color:e==="superAdmin"?"green":e==="hotelAdmin"?"blue":"red",style:{textTransform:"capitalize",fontSize:"12px"},children:e==="superAdmin"?"Super Admin":e==="hotelAdmin"?"Hotel Admin":"Customer"},e),filters:[{text:"Super Admin",value:"superAdmin"},{text:"Hotel Admin",value:"hotelAdmin"},{text:"Customer",value:"customer"}],onFilter:(e,s)=>s.role.indexOf(e)===0},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(S,{color:e==="active"?"green":"red",style:{textTransform:"capitalize",fontSize:"12px"},children:e==="active"?"Active":"Inactive"},e),filters:[{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],onFilter:(e,s)=>s.status.indexOf(e)===0},{title:"Action",key:"action",render:(e,s)=>t.jsxs(_,{size:"middle",children:[t.jsx(o,{icon:t.jsx(O,{}),onClick:()=>m("view",s)}),t.jsx(o,{icon:t.jsx(G,{}),onClick:()=>m("edit",s)})]})}],dataSource:w,loading:C,rowKey:"id",size:"small",pagination:{pageSize:U,onShowSizeChange:(e,s)=>{M(s),console.log("Page size changed to:",s)},showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,s)=>`${s[0]}-${s[1]} of ${e} items`},rowSelection:{type:"checkbox",onChange:(e,s)=>{console.log("selectedRowKeys",e),v(e),console.log("selectedRows",s)}}})]})]})};export{Z as default};
