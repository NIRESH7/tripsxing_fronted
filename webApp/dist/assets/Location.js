import{a as xe,b as fe,c as Se,u as Fe,r as h,j as a,F as $,D as be,q as S}from"./index.js";import{s as m,r as p,x as g,K as J,B as x,f as G,F as je,M as U,S as v,h as ke,z as N,c as L,o as M,U as we}from"./antd.js";import{S as H,D as $e}from"./MutationHooks.js";import{R as Ue}from"./UploadOutlined.js";import"./reactRouterDom.js";import"./zustand.js";const{TabPane:D}=J,qe=()=>{const[C,W]=m.useMessage(),[o,X]=p.useState("country"),[Y,f]=p.useState(!1),[c,Z]=p.useState("create"),[K,_]=p.useState(0),[i]=g.useForm(),{data:r,isLoading:q}=xe(),{data:I,isLoading:E}=fe(),{data:B,isLoading:T}=Se(),[ee,te]=p.useState(void 0),[ae,se]=p.useState(void 0),[oe,le]=p.useState(void 0),[V,b]=p.useState([]),[ne,ie]=p.useState([]),A=Fe(e=>e.CurrentUserData.id),F=(e,t)=>{Z(e),f(!0),e==="edit"&&_((t==null?void 0:t.id)||0)},re=()=>c==="create"?`Create${o.charAt(0).toUpperCase()+o.slice(1)}`:`Update${o.charAt(0).toUpperCase()+o.slice(1)}`,ce=`create${o.charAt(0).toUpperCase()+o.slice(1)}`,R=`Update${o.charAt(0).toUpperCase()+o.slice(1)}`,de=()=>c==="edit"?(console.log("routeKeyEdit",h.backend[R]+`/${K}`),h.backend[R]+`/${K}`):h.backend[ce],{mutate:z}=H({mutationKey:re(),queryKeyToInvalidate:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"],getSuccessMessage:e=>`${o.charAt(0).toUpperCase()+o.slice(1)} ${e.id?"updated":"created"} successfully`,getErrorMessage:(e,t)=>{m.error(`Failed to ${t.id?"update":"create"} ${o}: ${e}`)},onMutateCallback:e=>{console.log("onMutateCallback",e),C.open({key:"SaveLocationData",type:"loading",content:`Saving ${o.charAt(0).toUpperCase()+o.slice(1)}...`})},onSettledCallback:(e,t,s,l)=>{console.log("onSettledCallback",e,t,s,l),e.statusCode===200?C.open({key:"SaveLocationData",type:"success",content:`Successfully ${o.charAt(0).toUpperCase()+o.slice(1)} ${s.id?"updated":"created"}`}):C.open({key:"SaveLocationData",type:"error",content:`Failed to ${s.id?"update":"create"} ${o}`})},routes:de(),isUpdate:c==="edit"}),{mutate:P}=H({mutationKey:["uploadFileCountry"],queryKeyToInvalidate:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"],getSuccessMessage:()=>"File uploaded successfully",getErrorMessage:e=>`Failed to Upload file: ${e}`,onMutateCallback:e=>{console.log("onMutateCallback",e),C.open({key:"UploadFile",type:"loading",content:"Uploading file..."})},onSettledCallback:(e,t,s,l)=>{console.log("onSettledCallback",e,t,s,l),e.statusCode===200?C.open({key:"UploadFile",type:"success",content:"File uploaded successfully"}):C.open({key:"UploadFile",type:"error",content:"Failed to Upload file"})},routes:h.backend.uploadfile}),ue=()=>{const e=(l,n,Ie)=>{console.log("idKey",Ie);const w={name:l[`${n}Name`],userId:A,...n==="country"&&{countryId:l.countryId},...n==="state"&&{stateId:l.stateId,countryId:l.countryId},...n==="city"&&{stateId:l.stateId,countryId:l.countryId,cityId:l.cityId}};console.log("dataToSave",w),c==="edit"?z(w,{onSuccess:async d=>{console.log(`${n.charAt(0).toUpperCase()+n.slice(1)} created:`,d);const y=new FormData;if(l.images===void 0||l.images.length===0){i.resetFields(),f(!1),await S.invalidateQueries({queryKey:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"]});return}l.images.forEach(u=>{y.append("files",u.originFileObj)}),y.append(`${n}Id`,d.data.id),console.log("formData",y),P(y,{onSuccess:async u=>{console.log("Image upload response:",u),i.resetFields(),f(!1),await S.invalidateQueries({queryKey:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"]})},onError:u=>{console.error("Image upload failed:",u),m.error("Image upload failed")}})},onError:d=>{console.error(`Failed to save ${n} data:`,d),m.error(`Failed to save ${n} data: ${d}`)}}):z({...w,imageUrl:[]},{onSuccess:async d=>{console.log(`${n.charAt(0).toUpperCase()+n.slice(1)} created:`,d);const y=new FormData;l.images.forEach(u=>{y.append("files",u.originFileObj)}),y.append(`${n}Id`,d.data.id),console.log("formData",y),P(y,{onSuccess:async u=>{console.log("Image upload response:",u),i.resetFields(),f(!1),await S.invalidateQueries({queryKey:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"]})},onError:u=>{console.error("Image upload failed:",u),m.error("Image upload failed")}})},onError:d=>{console.error(`Failed to save ${n} data:`,d),m.error(`Failed to save ${n} data: ${d}`)}})},t=l=>{C.error("Validation failed",l)},s=l=>{i.validateFields().then(n=>e(n,l,`${l}Id`)).catch(t)};c==="create"?s(o==="country"?"country":o==="state"?"state":"city"):c==="edit"&&i.validateFields().then(l=>{e(l,o,`${o}Id`)}).catch(t)},me=()=>{i.resetFields(),f(!1)},O={country:[{title:"SI.no",dataIndex:"siNo",key:"siNo"},{title:"Name",dataIndex:"name",key:"name",filterDropdown:e=>a.jsx($,{...e,placeholder:"Search by Name"}),onFilter:(e,t)=>t.name.toLowerCase().includes(e.toLowerCase())},{title:"Images",dataIndex:"imageUrl",key:"imageUrl",render:e=>(console.log("imagescadscascas",e),a.jsx(v,{size:"middle",className:`cursor-pointer
                            `,children:e==null?void 0:e.map((t,s)=>a.jsx(ke,{src:t,alt:"stay",style:{width:50,height:50,objectFit:"cover"}},s))}))},{title:"Action",key:"action",render:e=>a.jsx(a.Fragment,{children:a.jsx(x,{icon:a.jsx(N,{}),onClick:()=>{console.log("Edit record:",e),te(e.id),i.setFieldsValue({countryName:e.name,images:e.imageUrl.map((t,s)=>({uid:s,name:t,status:"done",url:t}))}),F("edit",e)}})})}],state:[{title:"SI.no",dataIndex:"siNo",key:"siNo"},{title:"Name",dataIndex:"name",key:"name",filterDropdown:e=>a.jsx($,{...e,placeholder:"Search by Name"}),onFilter:(e,t)=>t.name.toLowerCase().includes(e.toLowerCase())},{title:"Country",dataIndex:"countryId",key:"countryId",render:e=>{const t=r==null?void 0:r.find(s=>s.id===e);return t==null?void 0:t.name}},{title:"Images",dataIndex:"imageUrl",key:"imageUrl",render:e=>(console.log("imagescadscascas",e),a.jsx(v,{size:"middle",className:`cursor-pointer
                            `,children:e==null?void 0:e.map((t,s)=>a.jsx("img",{src:t,alt:"stay",style:{width:50,height:50,objectFit:"cover"},onClick:()=>{U.info({title:`
                                            ${t.split("/").pop()}
                                            `,content:a.jsx("img",{src:t,alt:"stay",style:{width:"100%",height:"100%"}}),width:700})}},s))}))},{title:"Action",key:"action",render:e=>a.jsx(a.Fragment,{children:a.jsx(x,{icon:a.jsx(N,{}),onClick:()=>{se(e.id),i.setFieldsValue({stateName:e.name,images:e.imageUrl.map((t,s)=>({uid:s,name:t,status:"done",url:t})),countryId:e.countryId}),F("edit",e)}})})}],city:[{title:"SI.no",dataIndex:"siNo",key:"siNo"},{title:"Name",dataIndex:"name",key:"name",filterDropdown:e=>a.jsx($,{...e,placeholder:"Search by Name"}),onFilter:(e,t)=>t.name.toLowerCase().includes(e.toLowerCase())},{title:"Country",dataIndex:"countryId",key:"countryId",render:e=>{const t=r==null?void 0:r.find(s=>s.id===e);return t==null?void 0:t.name}},{title:"State",dataIndex:"stateId",key:"stateId",render:e=>{const t=I==null?void 0:I.find(s=>s.id===e);return t==null?void 0:t.name}},{title:"Images",dataIndex:"imageUrl",key:"imageUrl",render:e=>(console.log("imagescadscascas",e),a.jsx(v,{size:"middle",className:`cursor-pointer
                            `,children:e==null?void 0:e.map((t,s)=>a.jsx("img",{src:t,alt:"stay",style:{width:50,height:50,objectFit:"cover"},onClick:()=>{U.info({title:`
                                            ${t.split("/").pop()}
                                            `,content:a.jsx("img",{src:t,alt:"stay",style:{width:"100%",height:"100%"}}),width:700})}},s))}))},{title:"Action",key:"action",render:e=>a.jsx(a.Fragment,{children:a.jsx(x,{icon:a.jsx(N,{}),onClick:()=>{le(e.id),i.setFieldsValue({cityName:e.name,images:e.imageUrl.map((t,s)=>({uid:s,name:t,status:"done",url:t})),stateId:e.stateId,countryId:e.countryId}),F("edit",e)}})})}]},j=(e,t)=>{var s,l;return a.jsxs(a.Fragment,{children:[(!e.getFieldValue("images")&&t==="create"||t==="edit"&&((s=e.getFieldValue("images"))==null?void 0:s.length)===0)&&a.jsx(g.Item,{name:"images",label:"Images",rules:[{required:!0,message:"Please upload images",type:"array"}],children:a.jsx(we,{listType:"picture",beforeUpload:()=>!1,accept:"image/png, image/jpeg, image/jpg",onChange:n=>{console.log("info",n),e.setFieldsValue({images:n.fileList})},children:a.jsx(x,{icon:a.jsx(Ue,{}),children:"Upload Images"})})}),t!=="create"&&((l=e.getFieldValue("images"))==null?void 0:l.map(n=>a.jsxs("div",{style:{position:"relative",display:"inline-block",margin:5},children:[a.jsx("img",{src:n.url,alt:n.name,style:{width:100,height:100,objectFit:"cover"}},n.uid),a.jsx(G,{style:{position:"absolute",top:0,right:0,color:"red",cursor:"pointer"},onClick:()=>{Ce(n.url)}})]})))]})},ye=()=>({country:a.jsxs(a.Fragment,{children:[a.jsx(g.Item,{name:"countryName",label:"Country Name",rules:[{required:!0}],children:a.jsx(L,{})}),j(i,c)]}),state:a.jsxs(a.Fragment,{children:[a.jsx(g.Item,{name:"stateName",label:"State Name",rules:[{required:!0}],children:a.jsx(L,{})}),a.jsx(g.Item,{name:"countryId",label:"Country Name",rules:[{required:!0}],children:a.jsx(M,{options:r==null?void 0:r.map(t=>({label:t.name,value:t.id})),showSearch:!0,optionFilterProp:"label",filterSort:(t,s)=>((t==null?void 0:t.label)??"").toLowerCase().localeCompare(((s==null?void 0:s.label)??"").toLowerCase())})}),j(i,c)]}),city:a.jsxs(a.Fragment,{children:[a.jsx(g.Item,{name:"cityName",label:"City Name",rules:[{required:!0}],children:a.jsx(L,{})}),a.jsx(g.Item,{name:"stateId",label:"State Name",rules:[{required:!0}],children:a.jsx(M,{options:I==null?void 0:I.map(t=>({label:t.name,value:t.id})),showSearch:!0,optionFilterProp:"label",filterSort:(t,s)=>((t==null?void 0:t.label)??"").toLowerCase().localeCompare(((s==null?void 0:s.label)??"").toLowerCase())})}),a.jsx(g.Item,{name:"countryId",label:"Country Name",rules:[{required:!0}],children:a.jsx(M,{options:r==null?void 0:r.map(t=>({label:t.name,value:t.id})),showSearch:!0,optionFilterProp:"label",filterSort:(t,s)=>((t==null?void 0:t.label)??"").toLowerCase().localeCompare(((s==null?void 0:s.label)??"").toLowerCase())})}),j(i,c)]})})[o],k=(e,t)=>e?[]:t==null?void 0:t.map((s,l)=>({key:l,siNo:l+1,...s})),pe=()=>{switch(o){case"country":return k(q,r||[]);case"state":return k(E,I||[]);case"city":return k(T,B||[]);default:return[]}},ge=async()=>{if(console.log("selectedRowKeys",V),V.length===0)m.error(`Please select a ${o.charAt(0).toUpperCase()+o.slice(1)} to delete`);else if(confirm(`Are you sure you want to delete ${o} ?`)){const e=await be(o==="country"?h.backend.deleteCountry:o==="state"?h.backend.deleteState:h.backend.deleteCity,{userId:A,id:ne.map(t=>t.id)});if(e.statusCode===200){m.success(`${o} deleted successfully`);const t=await S.invalidateQueries({queryKey:o==="country"?["Countries"]:o==="state"?["States"]:["Cities"]});console.log("data",S.getQueriesData({queryKey:["Stays"]})),console.log("data",t),b([])}else m.error({content:e.message,key:"updatable",duration:2})}},{mutate:he}=$e({mutationKey:["deleteFile"],queryKeyToInvalidate:["Stays"],getSuccessMessage:()=>"File deleted successfully",getErrorMessage:e=>`Failed to delete file: ${e}`,onMutateCallback:e=>console.log("onMutateCallback",e),onSettledCallback:(e,t,s,l)=>console.log("onSettledCallback",e,t,s,l),routes:h.backend.deleteFile}),Q=e=>{const t=e.split("/");return t[t.length-1]},Ce=e=>{const t=Q(e);let s;o==="country"&&(s={key:t,countryId:ee,url:e}),o==="state"&&(s={key:t,stateId:ae,url:e}),o==="city"&&(s={key:t,cityId:oe,url:e}),console.log("data",s),he(s,{onSuccess:()=>{const l=(i.getFieldValue("images")||[]).filter(n=>Q(n.url)!==t);i.setFieldsValue({images:l}),m.success("File deleted successfully")},onError:l=>{m.error(`Failed to delete file: ${l}`)}})};return a.jsxs("div",{className:"p-5",children:[W,a.jsxs(J,{defaultActiveKey:"country",onChange:e=>{X(e),b([])},children:[a.jsx(D,{tab:"Country"},"country"),a.jsx(D,{tab:"State"},"state"),a.jsx(D,{tab:"City"},"city")]}),a.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx(x,{type:"primary",onClick:()=>{F("create",void 0),i.resetFields()},children:`Create ${o.charAt(0).toUpperCase()+o.slice(1)}`}),a.jsx(x,{type:"text",className:"bg-red-500 text-white border-none rounded-md px-4 py-2 hover:bg-red-600",onClick:()=>ge(),icon:a.jsx(G,{}),children:`Delete ${o.charAt(0).toUpperCase()+o.slice(1)}`})]})}),a.jsx(je,{columns:O&&O[o],dataSource:pe(),loading:q||E||T,scroll:{x:"auto"},size:"small",pagination:{pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},rowSelection:{type:"checkbox",onChange:(e,t)=>{console.log("selectedRowKeys",e),b(e),ie(t),console.log("selectedRows",t)}}}),a.jsx(U,{title:`${c.charAt(0).toUpperCase()+c.slice(1)} ${o.charAt(0).toUpperCase()+o.slice(1)}`,open:Y,onOk:ue,onCancel:me,okText:"Save",cancelButtonProps:{style:{display:"inline-block"}},children:a.jsx(g,{form:i,layout:"vertical",children:ye()})})]})};export{qe as default};
